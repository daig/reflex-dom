<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Reflex/Dom/Widget/Basic.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DataKinds #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE GADTs #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE LambdaCase #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE MultiParamTypeClasses #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE OverloadedStrings #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE RecursiveDo #-}</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-12"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies #-}</span>
<a name="line-13"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dom</span><span class='hs-varop'>.</span><span class='hs-conid'>Widget</span><span class='hs-varop'>.</span><span class='hs-conid'>Basic</span>
<a name="line-14"></a>  <span class='hs-layout'>(</span> <span class='hs-varid'>partitionMapBySetLT</span>
<a name="line-15"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listHoldWithKey</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>ChildResult</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-17"></a>
<a name="line-18"></a>  <span class='hs-comment'>-- * Displaying Values</span>
<a name="line-19"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>text</span>
<a name="line-20"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dynText</span>
<a name="line-21"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>display</span>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>button</span>
<a name="line-23"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dyn</span>
<a name="line-24"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>widgetHold</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>untilReady</span>
<a name="line-26"></a>
<a name="line-27"></a>  <span class='hs-comment'>-- * Working with Maps</span>
<a name="line-28"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>diffMapNoEq</span>
<a name="line-29"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>diffMap</span>
<a name="line-30"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>applyMap</span>
<a name="line-31"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mapPartitionEithers</span>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>applyMapKeysSet</span>
<a name="line-33"></a>
<a name="line-34"></a>  <span class='hs-comment'>-- * Widgets on Collections</span>
<a name="line-35"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKey</span>
<a name="line-36"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKey'</span>
<a name="line-37"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKeyShallowDiff</span>
<a name="line-38"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listViewWithKey</span>
<a name="line-39"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>selectViewListWithKey</span>
<a name="line-40"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>selectViewListWithKey_</span>
<a name="line-41"></a>
<a name="line-42"></a>  <span class='hs-comment'>-- * Creating DOM Elements</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>el</span>
<a name="line-44"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elAttr</span>
<a name="line-45"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elClass</span>
<a name="line-46"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elDynAttr</span>
<a name="line-47"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elDynClass</span>
<a name="line-48"></a>
<a name="line-49"></a>  <span class='hs-comment'>-- ** With Element Results</span>
<a name="line-50"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>el'</span>
<a name="line-51"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elAttr'</span>
<a name="line-52"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elClass'</span>
<a name="line-53"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elDynAttr'</span>
<a name="line-54"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elDynClass'</span>
<a name="line-55"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>elDynAttrNS'</span>
<a name="line-56"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dynamicAttributesToModifyAttributes</span>
<a name="line-57"></a>
<a name="line-58"></a>  <span class='hs-comment'>-- * List Utils</span>
<a name="line-59"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>list</span>
<a name="line-60"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>simpleList</span>
<a name="line-61"></a>
<a name="line-62"></a>  <span class='hs-comment'>-- * Specific DOM Elements</span>
<a name="line-63"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Link</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-64"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>linkClass</span>
<a name="line-65"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>link</span>
<a name="line-66"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>divClass</span>
<a name="line-67"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>dtdd</span>
<a name="line-68"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>blank</span>
<a name="line-69"></a>
<a name="line-70"></a>  <span class='hs-comment'>-- * Workflows</span>
<a name="line-71"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Workflow</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-72"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>workflow</span>
<a name="line-73"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>workflowView</span>
<a name="line-74"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mapWorkflow</span>
<a name="line-75"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>mapWorkflowCheap</span>
<a name="line-76"></a>
<a name="line-77"></a>  <span class='hs-comment'>-- * Tables and Lists</span>
<a name="line-78"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>tableDynAttr</span>
<a name="line-79"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>tabDisplay</span>
<a name="line-80"></a>
<a name="line-81"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>HasAttributes</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-82"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-83"></a>
<a name="line-84"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-85"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dom</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-86"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dom</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-87"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dynamic</span>
<a name="line-88"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>PostBuild</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-89"></a>
<a name="line-90"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>
<a name="line-91"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Lens</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>children</span><span class='hs-layout'>,</span> <span class='hs-varid'>element</span><span class='hs-layout'>)</span>
<a name="line-92"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Reader</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>forM</span><span class='hs-layout'>,</span> <span class='hs-varid'>forM_</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapM</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapM_</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence_</span><span class='hs-layout'>)</span>
<a name="line-93"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Align</span>
<a name="line-94"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Default</span>
<a name="line-95"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Either</span>
<a name="line-96"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Foldable</span>
<a name="line-97"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Misc</span>
<a name="line-98"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-layout'>)</span>
<a name="line-99"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-100"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
<a name="line-101"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-layout'>(</span><span class='hs-conid'>Set</span><span class='hs-layout'>)</span>
<a name="line-102"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Set</span>
<a name="line-103"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-104"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>T</span>
<a name="line-105"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>These</span>
<a name="line-106"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Traversable</span>
<a name="line-107"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapM</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapM_</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence_</span><span class='hs-layout'>)</span>
<a name="line-108"></a>
<a name="line-109"></a><a name="widgetHoldInternal"></a><span class='hs-definition'>widgetHoldInternal</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-110"></a><span class='hs-definition'>widgetHoldInternal</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>runWithReplace</span>
<a name="line-111"></a>
<a name="line-112"></a><span class='hs-comment'>-- | Breaks the given Map into pieces based on the given Set.  Each piece will contain only keys that are less than the key of the piece, and greater than or equal to the key of the piece with the next-smaller key.  There will be one additional piece containing all keys from the original Map that are larger or equal to the largest key in the Set.</span>
<a name="line-113"></a><span class='hs-comment'>-- Either k () is used instead of Maybe k so that the resulting map of pieces is sorted so that the additional piece has the largest key.</span>
<a name="line-114"></a><span class='hs-comment'>-- No empty pieces will be included in the output.</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="partitionMapBySetLT"></a><span class='hs-comment'>--TODO: This can probably be done more efficiently by dividing and conquering, re-using the structure of the Set instead of going through the Set linearally</span>
<a name="line-117"></a><span class='hs-definition'>partitionMapBySetLT</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-varop'>.</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Set</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-varid'>k</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-118"></a><span class='hs-definition'>partitionMapBySetLT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>fromDistinctAscList</span> <span class='hs-varop'>$</span> <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>toAscList</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>m0</span>
<a name="line-119"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>go</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-varid'>k</span> <span class='hs-conid'>()</span><span class='hs-layout'>,</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-120"></a>        <span class='hs-varid'>go</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>null</span> <span class='hs-varid'>m</span>
<a name="line-121"></a>                  <span class='hs-keyword'>then</span> <span class='hs-conid'>[]</span>
<a name="line-122"></a>                  <span class='hs-keyword'>else</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-conid'>()</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-123"></a>        <span class='hs-varid'>go</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span><span class='hs-conop'>:</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>lt</span><span class='hs-layout'>,</span> <span class='hs-varid'>eq</span><span class='hs-layout'>,</span> <span class='hs-varid'>gt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>splitLookup</span> <span class='hs-varid'>h</span> <span class='hs-varid'>m</span>
<a name="line-124"></a>                         <span class='hs-varid'>geq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>insert</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-varid'>eq</span> <span class='hs-varid'>gt</span>
<a name="line-125"></a>                     <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>null</span> <span class='hs-varid'>lt</span>
<a name="line-126"></a>                        <span class='hs-keyword'>then</span> <span class='hs-varid'>go</span> <span class='hs-varid'>t</span> <span class='hs-varid'>geq</span>
<a name="line-127"></a>                        <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>h</span><span class='hs-layout'>,</span> <span class='hs-varid'>lt</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>go</span> <span class='hs-varid'>t</span> <span class='hs-varid'>geq</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="ChildResult"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ChildResult</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ChildResult</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unChildResult</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>ChildResult</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-130"></a>
<a name="line-131"></a><a name="listHoldWithKey"></a><span class='hs-definition'>listHoldWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-132"></a><span class='hs-definition'>listHoldWithKey</span> <span class='hs-varid'>m0</span> <span class='hs-varid'>m'</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-133"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>dm0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapWithFunctorToDMap</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapWithKey</span> <span class='hs-varid'>f</span> <span class='hs-varid'>m0</span>
<a name="line-134"></a>      <span class='hs-varid'>dm'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatchDMap</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mapWithFunctorToDMap</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapWithKey</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComposeMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>m'</span>
<a name="line-135"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>a0</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sequenceDMapWithAdjust</span> <span class='hs-varid'>dm0</span> <span class='hs-varid'>dm'</span>
<a name="line-136"></a>  <span class='hs-varid'>fmap</span> <span class='hs-varid'>dmapToMap</span> <span class='hs-varop'>.</span> <span class='hs-varid'>incrementalToDynamic</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>holdIncremental</span> <span class='hs-varid'>a0</span> <span class='hs-varid'>a'</span> <span class='hs-comment'>--TODO: Move the dmapToMap to the righthand side so it doesn't get fully redone every time</span>
<a name="line-137"></a>
<a name="line-138"></a><a name="text"></a><span class='hs-definition'>text</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-139"></a><span class='hs-definition'>text</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>textNode</span> <span class='hs-varop'>$</span> <span class='hs-varid'>def</span> <span class='hs-varop'>&amp;</span> <span class='hs-varid'>textNodeConfig_initialContents</span> <span class='hs-varop'>.~</span> <span class='hs-varid'>t</span>
<a name="line-140"></a>
<a name="line-141"></a><a name="dynText"></a><span class='hs-definition'>dynText</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-142"></a><span class='hs-definition'>dynText</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-143"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-144"></a>  <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>textNode</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>def</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TextNodeConfig</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;</span> <span class='hs-varid'>textNodeConfig_setContents</span> <span class='hs-varop'>.~</span> <span class='hs-varid'>leftmost</span>
<a name="line-145"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>t</span>
<a name="line-146"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>tag</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>postBuild</span>
<a name="line-147"></a>    <span class='hs-keyglyph'>]</span>
<a name="line-148"></a>  <span class='hs-varid'>notReadyUntil</span> <span class='hs-varid'>postBuild</span>
<a name="line-149"></a>
<a name="line-150"></a><a name="display"></a><span class='hs-definition'>display</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-151"></a><span class='hs-definition'>display</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dynText</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>pack</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span>
<a name="line-152"></a>
<a name="line-153"></a><a name="button"></a><span class='hs-definition'>button</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-154"></a><span class='hs-definition'>button</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-155"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>element</span> <span class='hs-str'>"button"</span> <span class='hs-varid'>def</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-varid'>t</span>
<a name="line-156"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>domEvent</span> <span class='hs-conid'>Click</span> <span class='hs-varid'>e</span>
<a name="line-157"></a>
<a name="line-158"></a><a name="dyn"></a><span class='hs-comment'>--TODO: Should this be renamed to 'widgetView' for consistency with 'widgetHold'?</span>
<a name="line-159"></a><span class='hs-comment'>-- | Given a Dynamic of widget-creating actions, create a widget that is recreated whenever the Dynamic updates.</span>
<a name="line-160"></a><span class='hs-comment'>--   The returned Event of widget results occurs when the Dynamic does.</span>
<a name="line-161"></a><span class='hs-comment'>--   Note:  Often, the type 'a' is an Event, in which case the return value is an Event-of-Events that would typically be flattened (via 'switchPromptly').</span>
<a name="line-162"></a><span class='hs-definition'>dyn</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-163"></a><span class='hs-definition'>dyn</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-164"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-165"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>newChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftmost</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>updated</span> <span class='hs-varid'>child</span><span class='hs-layout'>,</span> <span class='hs-varid'>tagCheap</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>child</span><span class='hs-layout'>)</span> <span class='hs-varid'>postBuild</span><span class='hs-keyglyph'>]</span>
<a name="line-166"></a>  <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>widgetHoldInternal</span> <span class='hs-varid'>notReady</span> <span class='hs-varid'>newChild</span>
<a name="line-167"></a>
<a name="line-168"></a><a name="widgetHold"></a><span class='hs-comment'>-- | Given an initial widget and an Event of widget-creating actions, create a widget that is recreated whenever the Event fires.</span>
<a name="line-169"></a><span class='hs-comment'>--   The returned Dynamic of widget results occurs when the Event does.</span>
<a name="line-170"></a><span class='hs-comment'>--   Note:  Often, the type 'a' is an Event, in which case the return value is a Dynamic-of-Events that would typically be flattened.</span>
<a name="line-171"></a><span class='hs-definition'>widgetHold</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-172"></a><span class='hs-definition'>widgetHold</span> <span class='hs-varid'>child0</span> <span class='hs-varid'>newChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-173"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>result0</span><span class='hs-layout'>,</span> <span class='hs-varid'>newResult</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>widgetHoldInternal</span> <span class='hs-varid'>child0</span> <span class='hs-varid'>newChild</span>
<a name="line-174"></a>  <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>result0</span> <span class='hs-varid'>newResult</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="untilReady"></a><span class='hs-comment'>-- | Render a placeholder widget to be shown while another widget is not yet</span>
<a name="line-177"></a><span class='hs-comment'>-- done rendering</span>
<a name="line-178"></a><span class='hs-definition'>untilReady</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-179"></a><span class='hs-definition'>untilReady</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-180"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-181"></a>  <span class='hs-varid'>runWithReplace</span> <span class='hs-varid'>a</span> <span class='hs-varop'>$</span> <span class='hs-varid'>b</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>postBuild</span>
<a name="line-182"></a>
<a name="line-183"></a><a name="diffMapNoEq"></a><span class='hs-definition'>diffMapNoEq</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-184"></a><span class='hs-definition'>diffMapNoEq</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>align</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-185"></a>  <span class='hs-conid'>This</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span>
<a name="line-186"></a>  <span class='hs-conid'>These</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-187"></a>  <span class='hs-conid'>That</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-188"></a>
<a name="line-189"></a><a name="diffMap"></a><span class='hs-definition'>diffMap</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-190"></a><span class='hs-definition'>diffMap</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>align</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-191"></a>  <span class='hs-conid'>This</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span>
<a name="line-192"></a>  <span class='hs-conid'>These</span> <span class='hs-varid'>old</span> <span class='hs-varid'>new</span>
<a name="line-193"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>old</span> <span class='hs-varop'>==</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-194"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-195"></a>  <span class='hs-conid'>That</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-196"></a>
<a name="line-197"></a><a name="applyMap"></a><span class='hs-definition'>applyMap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span>
<a name="line-198"></a><span class='hs-definition'>applyMap</span> <span class='hs-varid'>patch</span> <span class='hs-varid'>old</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>insertions</span> <span class='hs-varop'>`</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>union</span><span class='hs-varop'>`</span> <span class='hs-layout'>(</span><span class='hs-varid'>old</span> <span class='hs-varop'>`</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>difference</span><span class='hs-varop'>`</span> <span class='hs-varid'>deletions</span><span class='hs-layout'>)</span>
<a name="line-199"></a>  <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>deletions</span><span class='hs-layout'>,</span> <span class='hs-varid'>insertions</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapPartitionEithers</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybeToEither</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>patch</span>
<a name="line-200"></a>        <span class='hs-varid'>maybeToEither</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-201"></a>          <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-conid'>()</span>
<a name="line-202"></a>          <span class='hs-conid'>Just</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>r</span>
<a name="line-203"></a>
<a name="line-204"></a><a name="mapPartitionEithers"></a><span class='hs-definition'>mapPartitionEithers</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Either</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-205"></a><span class='hs-definition'>mapPartitionEithers</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromLeft</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>ls</span><span class='hs-layout'>,</span> <span class='hs-varid'>fromRight</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span>
<a name="line-206"></a>  <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>ls</span><span class='hs-layout'>,</span> <span class='hs-varid'>rs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>partition</span> <span class='hs-varid'>isLeft</span> <span class='hs-varid'>m</span>
<a name="line-207"></a>        <span class='hs-varid'>fromLeft</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-208"></a>        <span class='hs-varid'>fromLeft</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"mapPartitionEithers: fromLeft received a Right value; this should be impossible"</span>
<a name="line-209"></a>        <span class='hs-varid'>fromRight</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-210"></a>        <span class='hs-varid'>fromRight</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"mapPartitionEithers: fromRight received a Left value; this should be impossible"</span>
<a name="line-211"></a>
<a name="line-212"></a><a name="applyMapKeysSet"></a><span class='hs-comment'>-- | Apply a map patch to a set</span>
<a name="line-213"></a><span class='hs-comment'>-- &gt; applyMapKeysSet patch (Map.keysSet m) == Map.keysSet (applyMap patch m)</span>
<a name="line-214"></a><span class='hs-definition'>applyMapKeysSet</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Set</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Set</span> <span class='hs-varid'>k</span>
<a name="line-215"></a><span class='hs-definition'>applyMapKeysSet</span> <span class='hs-varid'>patch</span> <span class='hs-varid'>old</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>keysSet</span> <span class='hs-varid'>insertions</span> <span class='hs-varop'>`</span><span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>union</span><span class='hs-varop'>`</span> <span class='hs-layout'>(</span><span class='hs-varid'>old</span> <span class='hs-varop'>`</span><span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>difference</span><span class='hs-varop'>`</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>keysSet</span> <span class='hs-varid'>deletions</span><span class='hs-layout'>)</span>
<a name="line-216"></a>  <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>insertions</span><span class='hs-layout'>,</span> <span class='hs-varid'>deletions</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>partition</span> <span class='hs-varid'>isJust</span> <span class='hs-varid'>patch</span>
<a name="line-217"></a>
<a name="line-218"></a><a name="listWithKey"></a><span class='hs-comment'>--TODO: Something better than Dynamic t (Map k v) - we want something where the Events carry diffs, not the whole value</span>
<a name="line-219"></a><span class='hs-definition'>listWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-220"></a><span class='hs-definition'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-221"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-222"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fanMap</span> <span class='hs-varop'>$</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>vals</span>
<a name="line-223"></a>      <span class='hs-comment'>-- We keep track of changes to children values in the mkChild function we pass to listHoldWithKey</span>
<a name="line-224"></a>      <span class='hs-comment'>-- The other changes we need to keep track of are child insertions and deletions. diffOnlyKeyChanges</span>
<a name="line-225"></a>      <span class='hs-comment'>-- keeps track of insertions and deletions but ignores value changes, since they're already accounted for.</span>
<a name="line-226"></a>      <span class='hs-varid'>diffOnlyKeyChanges</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>align</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-227"></a>        <span class='hs-conid'>This</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span>
<a name="line-228"></a>        <span class='hs-conid'>These</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-229"></a>        <span class='hs-conid'>That</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-230"></a>  <span class='hs-varid'>rec</span> <span class='hs-varid'>sentVals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foldDyn</span> <span class='hs-varid'>applyMap</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varid'>changeVals</span>
<a name="line-231"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>changeVals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-232"></a>          <span class='hs-varid'>changeVals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>attachWith</span> <span class='hs-varid'>diffOnlyKeyChanges</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>sentVals</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>leftmost</span>
<a name="line-233"></a>                         <span class='hs-keyglyph'>[</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>vals</span>
<a name="line-234"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>tag</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>vals</span><span class='hs-layout'>)</span> <span class='hs-varid'>postBuild</span> <span class='hs-comment'>--TODO: This should probably be added to the attachWith, not to the updated; if we were using diffMap instead of diffMapNoEq, I think it might not work</span>
<a name="line-235"></a>                         <span class='hs-keyglyph'>]</span>
<a name="line-236"></a>  <span class='hs-varid'>listHoldWithKey</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varid'>changeVals</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-237"></a>    <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-varid'>select</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Const2</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-238"></a>
<a name="line-239"></a><a name="listWithKey'"></a><span class='hs-comment'>{-# DEPRECATED listWithKey' "listWithKey' has been renamed to listWithKeyShallowDiff; also, its behavior has changed to fix a bug where children were always rebuilt (never updated)" #-}</span>
<a name="line-240"></a><span class='hs-definition'>listWithKey'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-241"></a><span class='hs-definition'>listWithKey'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listWithKeyShallowDiff</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="listWithKeyShallowDiff"></a><span class='hs-comment'>-- | Display the given map of items (in key order) using the builder function provided, and update it with the given event.  'Nothing' update entries will delete the corresponding children, and 'Just' entries will create them if they do not exist or send an update event to them if they do.</span>
<a name="line-244"></a><span class='hs-definition'>listWithKeyShallowDiff</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-245"></a><span class='hs-definition'>listWithKeyShallowDiff</span> <span class='hs-varid'>initialVals</span> <span class='hs-varid'>valsChanged</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-246"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fanMap</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span>
<a name="line-247"></a>  <span class='hs-varid'>sentVals</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foldDyn</span> <span class='hs-varid'>applyMap</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>void</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span>
<a name="line-248"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>relevantPatch</span> <span class='hs-varid'>patch</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>patch</span> <span class='hs-keyword'>of</span>
<a name="line-249"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span> <span class='hs-comment'>-- Even if we let a Nothing through when the element doesn't already exist, this doesn't cause a problem because it is ignored</span>
<a name="line-250"></a>        <span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span> <span class='hs-comment'>-- We don't want to let spurious re-creations of items through</span>
<a name="line-251"></a>  <span class='hs-varid'>listHoldWithKey</span> <span class='hs-varid'>initialVals</span> <span class='hs-layout'>(</span><span class='hs-varid'>attachWith</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>differenceWith</span> <span class='hs-varid'>relevantPatch</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>sentVals</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-252"></a>    <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varop'>$</span> <span class='hs-varid'>select</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Const2</span> <span class='hs-varid'>k</span>
<a name="line-253"></a>
<a name="line-254"></a><a name="listViewWithKey"></a><span class='hs-comment'>--TODO: Something better than Dynamic t (Map k v) - we want something where the Events carry diffs, not the whole value</span>
<a name="line-255"></a><span class='hs-comment'>-- | Create a dynamically-changing set of Event-valued widgets.</span>
<a name="line-256"></a><span class='hs-comment'>--   This is like listWithKey, specialized for widgets returning (Event t a).  listWithKey would return 'Dynamic t (Map k (Event t a))' in this scenario, but listViewWithKey flattens this to 'Event t (Map k a)' via 'switch'.</span>
<a name="line-257"></a><span class='hs-definition'>listViewWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-258"></a><span class='hs-definition'>listViewWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>mergeMap</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>listViewWithKey'</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-259"></a>
<a name="line-260"></a><a name="listViewWithKey'"></a><span class='hs-definition'>listViewWithKey'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-261"></a><span class='hs-definition'>listViewWithKey'</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>current</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-262"></a>
<a name="line-263"></a><a name="selectViewListWithKey"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets, one of which is selected at any time.</span>
<a name="line-264"></a><span class='hs-definition'>selectViewListWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-265"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span>          <span class='hs-comment'>-- ^ Current selection key</span>
<a name="line-266"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Dynamic key/value map</span>
<a name="line-267"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Function to create a widget for a given key from Dynamic value and Dynamic Bool indicating if this widget is currently selected</span>
<a name="line-268"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Event that fires when any child's return Event fires.  Contains key of an arbitrary firing widget.</span>
<a name="line-269"></a><span class='hs-definition'>selectViewListWithKey</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-270"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>selectionDemux</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demux</span> <span class='hs-varid'>selection</span> <span class='hs-comment'>-- For good performance, this value must be shared across all children</span>
<a name="line-271"></a>  <span class='hs-varid'>selectChild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-272"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>selected</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demuxed</span> <span class='hs-varid'>selectionDemux</span> <span class='hs-varid'>k</span>
<a name="line-273"></a>    <span class='hs-varid'>selectSelf</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>selected</span>
<a name="line-274"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,)</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varid'>selectSelf</span>
<a name="line-275"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>switchPromptlyDyn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>leftmost</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>elems</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>selectChild</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="selectViewListWithKey_"></a><span class='hs-definition'>selectViewListWithKey_</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-278"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span>          <span class='hs-comment'>-- ^ Current selection key</span>
<a name="line-279"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Dynamic key/value map</span>
<a name="line-280"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Function to create a widget for a given key from Dynamic value and Dynamic Bool indicating if this widget is currently selected</span>
<a name="line-281"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Event that fires when any child's return Event fires.  Contains key of an arbitrary firing widget.</span>
<a name="line-282"></a><span class='hs-definition'>selectViewListWithKey_</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>selectViewListWithKey</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-283"></a>
<a name="line-284"></a><a name="el"></a><span class='hs-comment'>-- | Create a DOM element</span>
<a name="line-285"></a><span class='hs-comment'>-- &gt; el "div" (text "Hello World")</span>
<a name="line-286"></a><span class='hs-comment'>-- &lt;div&gt;Hello World&lt;/div&gt;</span>
<a name="line-287"></a><span class='hs-comment'>{-# INLINABLE el #-}</span>
<a name="line-288"></a><span class='hs-definition'>el</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-289"></a><span class='hs-definition'>el</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>el'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>child</span>
<a name="line-290"></a>
<a name="line-291"></a><a name="elAttr"></a><span class='hs-comment'>-- | Create a DOM element with attributes</span>
<a name="line-292"></a><span class='hs-comment'>-- &gt; elAttr "a" ("href" =: "<a href="http://google.com">http://google.com</a>") (text "Google!")</span>
<a name="line-293"></a><span class='hs-comment'>-- &lt;a href="<a href="http://google.com">http://google.com</a>"&gt;Google!&lt;/a&gt;</span>
<a name="line-294"></a><span class='hs-comment'>{-# INLINABLE elAttr #-}</span>
<a name="line-295"></a><span class='hs-definition'>elAttr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-296"></a><span class='hs-definition'>elAttr</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>elAttr'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>child</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="elClass"></a><span class='hs-comment'>-- | Create a DOM element with classes</span>
<a name="line-299"></a><span class='hs-comment'>-- &gt; elClass "div" "row" (return ())</span>
<a name="line-300"></a><span class='hs-comment'>-- &lt;div class="row"&gt;&lt;/div&gt;</span>
<a name="line-301"></a><span class='hs-comment'>{-# INLINABLE elClass #-}</span>
<a name="line-302"></a><span class='hs-definition'>elClass</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-303"></a><span class='hs-definition'>elClass</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>elClass'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-varid'>child</span>
<a name="line-304"></a>
<a name="line-305"></a><a name="elDynAttr"></a><span class='hs-comment'>-- | Create a DOM element with Dynamic Attributes</span>
<a name="line-306"></a><span class='hs-comment'>-- &gt; elClass "div" (constDyn ("class" =: "row")) (return ())</span>
<a name="line-307"></a><span class='hs-comment'>-- &lt;div class="row"&gt;&lt;/div&gt;</span>
<a name="line-308"></a><span class='hs-comment'>{-# INLINABLE elDynAttr #-}</span>
<a name="line-309"></a><span class='hs-definition'>elDynAttr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-310"></a><span class='hs-definition'>elDynAttr</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>elDynAttr'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>child</span>
<a name="line-311"></a>
<a name="line-312"></a><a name="elDynClass"></a><span class='hs-comment'>-- | Create a DOM element with a Dynamic Class</span>
<a name="line-313"></a><span class='hs-comment'>-- &gt; elDynClass "div" (constDyn "row") (return ())</span>
<a name="line-314"></a><span class='hs-comment'>-- &lt;div class="row"&gt;&lt;/div&gt;</span>
<a name="line-315"></a><span class='hs-comment'>{-# INLINABLE elDynClass #-}</span>
<a name="line-316"></a><span class='hs-definition'>elDynClass</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-317"></a><span class='hs-definition'>elDynClass</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>elDynClass'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-varid'>child</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="el'"></a><span class='hs-comment'>-- | Create a DOM element and return the element</span>
<a name="line-320"></a><span class='hs-comment'>-- &gt; do (e, _) &lt;- el' "div" (text "Click")</span>
<a name="line-321"></a><span class='hs-comment'>-- &gt;    return $ domEvent Click e</span>
<a name="line-322"></a><span class='hs-comment'>{-# INLINABLE el' #-}</span>
<a name="line-323"></a><span class='hs-definition'>el'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-324"></a><span class='hs-definition'>el'</span> <span class='hs-varid'>elementTag</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>element</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>def</span>
<a name="line-325"></a>
<a name="line-326"></a><a name="elAttr'"></a><span class='hs-comment'>-- | Create a DOM element with attributes and return the element</span>
<a name="line-327"></a><span class='hs-comment'>{-# INLINABLE elAttr' #-}</span>
<a name="line-328"></a><span class='hs-definition'>elAttr'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-329"></a><span class='hs-definition'>elAttr'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>element</span> <span class='hs-varid'>elementTag</span> <span class='hs-varop'>$</span> <span class='hs-varid'>def</span>
<a name="line-330"></a>  <span class='hs-varop'>&amp;</span> <span class='hs-varid'>initialAttributes</span> <span class='hs-varop'>.~</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapKeys</span> <span class='hs-layout'>(</span><span class='hs-conid'>AttributeName</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-varid'>attrs</span>
<a name="line-331"></a>
<a name="line-332"></a><a name="elClass'"></a><span class='hs-comment'>-- | Create a DOM element with a class and return the element</span>
<a name="line-333"></a><span class='hs-comment'>{-# INLINABLE elClass' #-}</span>
<a name="line-334"></a><span class='hs-definition'>elClass'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-335"></a><span class='hs-definition'>elClass'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elAttr'</span> <span class='hs-varid'>elementTag</span> <span class='hs-layout'>(</span><span class='hs-str'>"class"</span> <span class='hs-varop'>=:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-336"></a>
<a name="line-337"></a><a name="elDynAttr'"></a><span class='hs-comment'>-- | Create a DOM element with Dynamic Attributes and return the element</span>
<a name="line-338"></a><span class='hs-comment'>{-# INLINABLE elDynAttr' #-}</span>
<a name="line-339"></a><span class='hs-definition'>elDynAttr'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-340"></a><span class='hs-definition'>elDynAttr'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elDynAttrNS'</span> <span class='hs-conid'>Nothing</span>
<a name="line-341"></a>
<a name="line-342"></a><a name="elDynClass'"></a><span class='hs-comment'>-- | Create a DOM element with a Dynamic class and return the element</span>
<a name="line-343"></a><span class='hs-comment'>{-# INLINABLE elDynClass' #-}</span>
<a name="line-344"></a><span class='hs-definition'>elDynClass'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-345"></a><span class='hs-definition'>elDynClass'</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elDynAttr'</span> <span class='hs-varid'>elementTag</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-str'>"class"</span> <span class='hs-varop'>=:</span><span class='hs-layout'>)</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-346"></a>
<a name="line-347"></a><a name="elDynAttrNS'"></a><span class='hs-comment'>{-# INLINABLE elDynAttrNS' #-}</span>
<a name="line-348"></a><span class='hs-definition'>elDynAttrNS'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-349"></a><span class='hs-definition'>elDynAttrNS'</span> <span class='hs-varid'>mns</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-350"></a>  <span class='hs-varid'>modifyAttrs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>dynamicAttributesToModifyAttributes</span> <span class='hs-varid'>attrs</span>
<a name="line-351"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>cfg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>def</span>
<a name="line-352"></a>        <span class='hs-varop'>&amp;</span> <span class='hs-varid'>elementConfig_namespace</span> <span class='hs-varop'>.~</span> <span class='hs-varid'>mns</span>
<a name="line-353"></a>        <span class='hs-varop'>&amp;</span> <span class='hs-varid'>modifyAttributes</span> <span class='hs-varop'>.~</span> <span class='hs-varid'>fmapCheap</span> <span class='hs-varid'>mapKeysToAttributeName</span> <span class='hs-varid'>modifyAttrs</span>
<a name="line-354"></a>  <span class='hs-varid'>result</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>element</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>cfg</span> <span class='hs-varid'>child</span>
<a name="line-355"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-356"></a>  <span class='hs-varid'>notReadyUntil</span> <span class='hs-varid'>postBuild</span>
<a name="line-357"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>result</span>
<a name="line-358"></a>
<a name="line-359"></a><a name="dynamicAttributesToModifyAttributes"></a><span class='hs-definition'>dynamicAttributesToModifyAttributes</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-360"></a><span class='hs-definition'>dynamicAttributesToModifyAttributes</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dynamicAttributesToModifyAttributesWithInitial</span> <span class='hs-varid'>mempty</span>
<a name="line-361"></a>
<a name="line-362"></a><a name="dynamicAttributesToModifyAttributesWithInitial"></a><span class='hs-definition'>dynamicAttributesToModifyAttributesWithInitial</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-363"></a><span class='hs-definition'>dynamicAttributesToModifyAttributesWithInitial</span> <span class='hs-varid'>attrs0</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-364"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-365"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>modificationsNeeded</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>push</span> <span class='hs-layout'>(</span><span class='hs-varid'>align</span> <span class='hs-varid'>postBuild</span> <span class='hs-varop'>$</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-366"></a>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-367"></a>          <span class='hs-conid'>This</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-368"></a>            <span class='hs-varid'>new</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sample</span> <span class='hs-varop'>$</span> <span class='hs-varid'>current</span> <span class='hs-varid'>d</span>
<a name="line-369"></a>            <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>diffMap</span> <span class='hs-varid'>attrs0</span> <span class='hs-varid'>new</span>
<a name="line-370"></a>          <span class='hs-conid'>These</span> <span class='hs-conid'>()</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>diffMap</span> <span class='hs-varid'>attrs0</span> <span class='hs-varid'>new</span>
<a name="line-371"></a>          <span class='hs-conid'>That</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-372"></a>            <span class='hs-varid'>old</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sample</span> <span class='hs-varop'>$</span> <span class='hs-varid'>current</span> <span class='hs-varid'>d</span>
<a name="line-373"></a>            <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>diffMap</span> <span class='hs-varid'>old</span> <span class='hs-varid'>new</span>
<a name="line-374"></a>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>null</span> <span class='hs-varid'>p</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>p</span>
<a name="line-375"></a>  <span class='hs-varid'>return</span> <span class='hs-varid'>modificationsNeeded</span>
<a name="line-376"></a>
<a name="line-377"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-378"></a><span class='hs-comment'>-- Copied and pasted from Reflex.Widget.Class</span>
<a name="line-379"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-380"></a>
<a name="line-381"></a><a name="list"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets from a Dynamic key/value map.</span>
<a name="line-382"></a><span class='hs-comment'>--   Unlike the 'withKey' variants, the child widgets are insensitive to which key they're associated with.</span>
<a name="line-383"></a><span class='hs-definition'>list</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-384"></a><span class='hs-definition'>list</span> <span class='hs-varid'>dm</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>dm</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>dv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkChild</span> <span class='hs-varid'>dv</span><span class='hs-layout'>)</span>
<a name="line-385"></a>
<a name="line-386"></a><a name="simpleList"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets from a Dynamic list.</span>
<a name="line-387"></a><span class='hs-definition'>simpleList</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-388"></a><span class='hs-definition'>simpleList</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>list</span> <span class='hs-varid'>mkChild</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>.</span> <span class='hs-varid'>zip</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
<a name="line-389"></a>
<a name="line-390"></a><span class='hs-comment'>{-
<a name="line-391"></a>schedulePostBuild x = performEvent_ . (x &lt;$) =&lt;&lt; getPostBuild
<a name="line-392"></a>
<a name="line-393"></a>elDynHtml' :: DomBuilder t m =&gt; Text -&gt; Dynamic t Text -&gt; m (El t)
<a name="line-394"></a>elDynHtml' elementTag html = do
<a name="line-395"></a>  e &lt;- buildEmptyElement elementTag (Map.empty :: Map Text Text)
<a name="line-396"></a>  schedulePostBuild $ setInnerHTML e . Just =&lt;&lt; sample (current html)
<a name="line-397"></a>  performEvent_ $ fmap (setInnerHTML e . Just) $ updated html
<a name="line-398"></a>  wrapElement defaultDomEventHandler e
<a name="line-399"></a>
<a name="line-400"></a>elDynHtmlAttr' :: DomBuilder t m =&gt; Text -&gt; Map Text Text -&gt; Dynamic t Text -&gt; m (El t)
<a name="line-401"></a>elDynHtmlAttr' elementTag attrs html = do
<a name="line-402"></a>  e &lt;- buildEmptyElement elementTag attrs
<a name="line-403"></a>  schedulePostBuild $ setInnerHTML e . Just =&lt;&lt; sample (current html)
<a name="line-404"></a>  performEvent_ $ fmap (setInnerHTML e . Just) $ updated html
<a name="line-405"></a>  wrapElement defaultDomEventHandler e
<a name="line-406"></a>-}</span>
<a name="line-407"></a>
<a name="line-408"></a><a name="Link"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Link</span> <span class='hs-varid'>t</span>
<a name="line-409"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Link</span> <span class='hs-layout'>{</span> <span class='hs-sel'>_link_clicked</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-conid'>()</span>
<a name="line-410"></a>         <span class='hs-layout'>}</span>
<a name="line-411"></a>
<a name="line-412"></a><a name="linkClass"></a><span class='hs-definition'>linkClass</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Link</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-413"></a><span class='hs-definition'>linkClass</span> <span class='hs-varid'>s</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-414"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>elAttr'</span> <span class='hs-str'>"a"</span> <span class='hs-layout'>(</span><span class='hs-str'>"class"</span> <span class='hs-varop'>=:</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-varid'>s</span>
<a name="line-415"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Link</span> <span class='hs-varop'>$</span> <span class='hs-varid'>domEvent</span> <span class='hs-conid'>Click</span> <span class='hs-varid'>l</span>
<a name="line-416"></a>
<a name="line-417"></a><a name="link"></a><span class='hs-definition'>link</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Link</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-418"></a><span class='hs-definition'>link</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>linkClass</span> <span class='hs-varid'>s</span> <span class='hs-str'>""</span>
<a name="line-419"></a>
<a name="line-420"></a><a name="divClass"></a><span class='hs-definition'>divClass</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-421"></a><span class='hs-definition'>divClass</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elClass</span> <span class='hs-str'>"div"</span>
<a name="line-422"></a>
<a name="line-423"></a><a name="dtdd"></a><span class='hs-definition'>dtdd</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-424"></a><span class='hs-definition'>dtdd</span> <span class='hs-varid'>h</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-425"></a>  <span class='hs-varid'>el</span> <span class='hs-str'>"dt"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-varid'>h</span>
<a name="line-426"></a>  <span class='hs-varid'>el</span> <span class='hs-str'>"dd"</span> <span class='hs-varid'>w</span>
<a name="line-427"></a>
<a name="line-428"></a><a name="blank"></a><span class='hs-definition'>blank</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-429"></a><span class='hs-definition'>blank</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-430"></a>
<a name="line-431"></a><a name="Workflow"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Workflow</span> <span class='hs-layout'>{</span> <span class='hs-varid'>unWorkflow</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>}</span>
<a name="line-432"></a>
<a name="line-433"></a><a name="workflow"></a><span class='hs-definition'>workflow</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-434"></a><span class='hs-definition'>workflow</span> <span class='hs-varid'>w0</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-435"></a>  <span class='hs-varid'>rec</span> <span class='hs-varid'>eResult</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>widgetHold</span> <span class='hs-layout'>(</span><span class='hs-varid'>unWorkflow</span> <span class='hs-varid'>w0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>unWorkflow</span> <span class='hs-varop'>$</span> <span class='hs-varid'>switch</span> <span class='hs-varop'>$</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>current</span> <span class='hs-varid'>eResult</span>
<a name="line-436"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>eResult</span>
<a name="line-437"></a>
<a name="line-438"></a><a name="workflowView"></a><span class='hs-definition'>workflowView</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-439"></a><span class='hs-definition'>workflowView</span> <span class='hs-varid'>w0</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-440"></a>  <span class='hs-varid'>rec</span> <span class='hs-varid'>eResult</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>dyn</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>unWorkflow</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>w0</span> <span class='hs-varid'>eReplace</span>
<a name="line-441"></a>      <span class='hs-varid'>eReplace</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>switch</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hold</span> <span class='hs-varid'>never</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>eResult</span>
<a name="line-442"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>eResult</span>
<a name="line-443"></a>
<a name="line-444"></a><a name="mapWorkflow"></a><span class='hs-definition'>mapWorkflow</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<a name="line-445"></a><span class='hs-definition'>mapWorkflow</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workflow</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Workflow</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>***</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapWorkflow</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-446"></a>
<a name="line-447"></a><a name="mapWorkflowCheap"></a><span class='hs-definition'>mapWorkflowCheap</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Workflow</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<a name="line-448"></a><span class='hs-definition'>mapWorkflowCheap</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Workflow</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Workflow</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varop'>***</span> <span class='hs-varid'>fmapCheap</span> <span class='hs-layout'>(</span><span class='hs-varid'>mapWorkflowCheap</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-449"></a>
<a name="line-450"></a><a name="tableDynAttr"></a><span class='hs-comment'>-- | A widget to display a table with static columns and dynamic rows.</span>
<a name="line-451"></a><span class='hs-definition'>tableDynAttr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>r</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-452"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span>                                   <span class='hs-comment'>-- ^ Class applied to &lt;table&gt; element</span>
<a name="line-453"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>,</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>      <span class='hs-comment'>-- ^ Columns of (header, row key -&gt; row value -&gt; child widget)</span>
<a name="line-454"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>                      <span class='hs-comment'>-- ^ Map from row key to row value</span>
<a name="line-455"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Function to compute &lt;tr&gt; element attributes from row key</span>
<a name="line-456"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Element</span> <span class='hs-conid'>EventResult</span> <span class='hs-layout'>(</span><span class='hs-conid'>DomBuilderSpace</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Map from row key to (El, list of widget return values)</span>
<a name="line-457"></a><span class='hs-definition'>tableDynAttr</span> <span class='hs-varid'>klass</span> <span class='hs-varid'>cols</span> <span class='hs-varid'>dRows</span> <span class='hs-varid'>rowAttrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elAttr</span> <span class='hs-str'>"div"</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"style"</span> <span class='hs-str'>"zoom: 1; overflow: auto; background: white;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-458"></a>    <span class='hs-varid'>elAttr</span> <span class='hs-str'>"table"</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"class"</span> <span class='hs-varid'>klass</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-459"></a>      <span class='hs-varid'>el</span> <span class='hs-str'>"thead"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>el</span> <span class='hs-str'>"tr"</span> <span class='hs-varop'>$</span>
<a name="line-460"></a>        <span class='hs-varid'>mapM_</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>el</span> <span class='hs-str'>"th"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>text</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span> <span class='hs-varid'>cols</span>
<a name="line-461"></a>      <span class='hs-varid'>el</span> <span class='hs-str'>"tbody"</span> <span class='hs-varop'>$</span>
<a name="line-462"></a>        <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>dRows</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-463"></a>          <span class='hs-varid'>dAttrs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>rowAttrs</span> <span class='hs-varid'>k</span>
<a name="line-464"></a>          <span class='hs-varid'>elDynAttr'</span> <span class='hs-str'>"tr"</span> <span class='hs-varid'>dAttrs</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>el</span> <span class='hs-str'>"td"</span> <span class='hs-varop'>$</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>x</span> <span class='hs-varid'>k</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varid'>cols</span><span class='hs-layout'>)</span>
<a name="line-465"></a>
<a name="line-466"></a><a name="tabDisplay"></a><span class='hs-comment'>-- | A widget to construct a tabbed view that shows only one of its child widgets at a time.</span>
<a name="line-467"></a><span class='hs-comment'>--   Creates a header bar containing a &lt;ul&gt; with one &lt;li&gt; per child; clicking a &lt;li&gt; displays</span>
<a name="line-468"></a><span class='hs-comment'>--   the corresponding child and hides all others.</span>
<a name="line-469"></a><span class='hs-definition'>tabDisplay</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-470"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span>               <span class='hs-comment'>-- ^ Class applied to &lt;ul&gt; element</span>
<a name="line-471"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span>               <span class='hs-comment'>-- ^ Class applied to currently active &lt;li&gt; element</span>
<a name="line-472"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>,</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Map from (arbitrary) key to (tab label, child widget)</span>
<a name="line-473"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-474"></a><span class='hs-definition'>tabDisplay</span> <span class='hs-varid'>ulClass</span> <span class='hs-varid'>activeClass</span> <span class='hs-varid'>tabItems</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-475"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>t0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listToMaybe</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>keys</span> <span class='hs-varid'>tabItems</span>
<a name="line-476"></a>  <span class='hs-varid'>rec</span> <span class='hs-varid'>currentTab</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Demux</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>elAttr</span> <span class='hs-str'>"ul"</span> <span class='hs-layout'>(</span><span class='hs-str'>"class"</span> <span class='hs-varop'>=:</span> <span class='hs-varid'>ulClass</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-477"></a>        <span class='hs-varid'>tabClicksList</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>elems</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>imapM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>headerBarLink</span> <span class='hs-varid'>s</span> <span class='hs-varid'>k</span> <span class='hs-varop'>$</span> <span class='hs-varid'>demuxed</span> <span class='hs-varid'>currentTab</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>tabItems</span>
<a name="line-478"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>eTabClicks</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>leftmost</span> <span class='hs-varid'>tabClicksList</span>
<a name="line-479"></a>        <span class='hs-varid'>fmap</span> <span class='hs-varid'>demux</span> <span class='hs-varop'>$</span> <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>t0</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>eTabClicks</span>
<a name="line-480"></a>  <span class='hs-varid'>el</span> <span class='hs-str'>"div"</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-481"></a>    <span class='hs-varid'>iforM_</span> <span class='hs-varid'>tabItems</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>w</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-482"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>isSelected</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demuxed</span> <span class='hs-varid'>currentTab</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>k</span>
<a name="line-483"></a>          <span class='hs-varid'>attrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ffor</span> <span class='hs-varid'>isSelected</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>s</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"style"</span> <span class='hs-str'>"display:none;"</span>
<a name="line-484"></a>      <span class='hs-varid'>elDynAttr</span> <span class='hs-str'>"div"</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>w</span>
<a name="line-485"></a>    <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-486"></a>  <span class='hs-keyword'>where</span>
<a name="line-487"></a>    <span class='hs-varid'>headerBarLink</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-488"></a>    <span class='hs-varid'>headerBarLink</span> <span class='hs-varid'>x</span> <span class='hs-varid'>k</span> <span class='hs-varid'>isSelected</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-489"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>attrs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>b</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"class"</span> <span class='hs-varid'>activeClass</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span><span class='hs-layout'>)</span> <span class='hs-varid'>isSelected</span>
<a name="line-490"></a>      <span class='hs-varid'>elDynAttr</span> <span class='hs-str'>"li"</span> <span class='hs-varid'>attrs</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-491"></a>        <span class='hs-varid'>a</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>link</span> <span class='hs-varid'>x</span>
<a name="line-492"></a>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-sel'>_link_clicked</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-493"></a>
<a name="line-494"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>HasAttributes</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-495"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Attrs</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span>
<a name="line-496"></a>  <span class='hs-varid'>attributes</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Lens'</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Attrs</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
</pre></body>
</html>
